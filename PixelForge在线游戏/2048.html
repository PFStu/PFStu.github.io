<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 PixelForgeWebGame</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #faf8ef;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .grid-container {
            width: 400px;
            height: 400px;
            background-color: #bbada0;
            padding: 10px;
            border-radius: 10px;
            position: relative;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
        }
        .tile {
            width: 100%;
            height: 100%;
            background-color: #cdc1b4;
            border-radius: 5px;
            text-align: center;
            line-height: 90px;
            font-size: 32px;
            color: #776e65;
            font-weight: bold;
            position: relative;
            transition: transform 0.3s ease;
        }
        .tile-2 { background-color: #eee4da; }
        .tile-4 { background-color: #ede0c8; }
        .tile-8 { background-color: #f2b179; color: #f9f6f2; }
        .tile-16 { background-color: #f59563; color: #f9f6f2; }
        .tile-32 { background-color: #f67c5f; color: #f9f6f2; }
        .tile-64 { background-color: #f65e3b; color: #f9f6f2; }
        .tile-128 { background-color: #edcf72; color: #f9f6f2; }
        .tile-256 { background-color: #edcc61; color: #f9f6f2; }
        .tile-512 { background-color: #edc850; color: #f9f6f2; }
        .tile-1024 { background-color: #edc53f; color: #f9f6f2; }
        .tile-2048 { background-color: #edc22e; color: #f9f6f2; }
    </style>
</head>
<body>
    <div class="grid-container" id="grid"></div>

    <script>
        const gridContainer = document.getElementById('grid');
        const grid = Array(4).fill().map(() => Array(4).fill(0));

        function drawGrid() {
            gridContainer.innerHTML = '';
            grid.forEach((row, r) => {
                row.forEach((value, c) => {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    if (value > 0) {
                        tile.classList.add(`tile-${value}`);
                        tile.textContent = value;
                    }
                    gridContainer.appendChild(tile);
                });
            });
        }

        function spawnNumber() {
            const emptyCells = [];
            grid.forEach((row, r) => {
                row.forEach((value, c) => {
                    if (value === 0) emptyCells.push([r, c]);
                });
            });

            if (emptyCells.length === 0) return;

            const [r, c] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            grid[r][c] = Math.random() < 0.9 ? 2 : 4;
        }

        function moveWithAnimation(direction) {
            const tempGrid = grid.map(row => row.slice());

            function slideAndMerge() {
                let moved = false;

                const slide = (row) => {
                    let newRow = row.filter(val => val);
                    while (newRow.length < 4) newRow.push(0);
                    return newRow;
                };

                const merge = (row) => {
                    for (let i = 0; i < 3; i++) {
                        if (row[i] === row[i + 1] && row[i] !== 0) {
                            row[i] *= 2;
                            row[i + 1] = 0;
                            moved = true;
                        }
                    }
                    return slide(row);
                };

                switch (direction) {
                    case 'left':
                        grid.forEach((row, r) => {
                            grid[r] = merge(slide(row));
                        });
                        break;
                    case 'right':
                        grid.forEach((row, r) => {
                            grid[r] = merge(slide(row.reverse())).reverse();
                        });
                        break;
                    case 'up':
                        for (let c = 0; c < 4; c++) {
                            const col = [0, 1, 2, 3].map(r => grid[r][c]);
                            const newCol = merge(slide(col));
                            newCol.forEach((val, r) => grid[r][c] = val);
                        }
                        break;
                    case 'down':
                        for (let c = 0; c < 4; c++) {
                            const col = [0, 1, 2, 3].map(r => grid[r][c]).reverse();
                            const newCol = merge(slide(col));
                            newCol.reverse().forEach((val, r) => grid[r][c] = val);
                        }
                        break;
                }
            }

            slideAndMerge();
            if (JSON.stringify(grid) !== JSON.stringify(tempGrid)) {
                spawnNumber();
                drawGrid();
            }
        }

        // 触摸事件处理函数
        function handleTouchStart(event) {
            touchStart = { x: event.touches[0].clientX, y: event.touches[0].clientY };
        }

        function handleTouchEnd(event) {
            touchEnd = { x: event.changedTouches[0].clientX, y: event.changedTouches[0].clientY };

            if (Math.abs(touchStart.x - touchEnd.x) > Math.abs(touchStart.y - touchEnd.y)) {
                if (touchStart.x - touchEnd.x > 100) {
                    moveWithAnimation('left');
                } else if (touchEnd.x - touchStart.x > 100) {
                    moveWithAnimation('right');
                }
            } else {
                if (touchStart.y - touchEnd.y > 100) {
                    moveWithAnimation('up');
                } else if (touchEnd.y - touchStart.y > 100) {
                    moveWithAnimation('down');
                }
            }
        }

        // 初始化触摸事件监听器
        gridContainer.addEventListener('touchstart', handleTouchStart);
        gridContainer.addEventListener('touchend', handleTouchEnd);

        // 初始化游戏
        spawnNumber();
        spawnNumber();
        drawGrid();
    </script>
</body>
</html>